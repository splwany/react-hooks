{"version":3,"sources":["utils/common.ts","components/ImageStitcher/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["getDate","d","Date","year","getFullYear","toString","month","getMonth","substring","date","getImageDataUrl","blob","Promise","resolve","reject","reader","FileReader","onloadend","event","imgDataUrl","target","result","onerror","err","readAsDataURL","getImageElements","imgDataUrlList","promiseList","map","img","Image","src","onload","all","imgElement2ImageData","imgElement","width","height","ratioW","ratioH","canvas","document","createElement","setAttribute","ctx","getContext","scale","drawImage","getImageData","cropImageData","imageData","top","bottom","data","start","Math","floor","end","ImageData","subarray","cropAndConcatImgDatas","imgElementList","cropRangeList","maxWidth","length","heightList","imgDataList","i","w","h","ratio","imgData","cropedImgData","push","lastY","putImageData","toDataURL","AreaSelector","onChange","useState","topTouched","setTopTouched","topStartY","setTopStartY","topStartOffset","setTopStartOffset","bottomTouched","setBottomTouched","bottomStartY","setBottomStartY","bottomStartOffset","setBottomStartOffset","topRef","useRef","bottomRef","areaRef","current","clientHeight","onTopBarStart","e","type","pageY","targetTouches","onBottomBarStart","onMove","fn","lock","unLock","requestAnimationFrame","throttle","newTop","style","topPercent","bottomPercent","background","newBottom","useEffect","mouseUpListener","Number","body","querySelector","addEventListener","removeEventListener","className","onMouseMove","onTouchMove","alt","ref","onMouseDown","onTouchStart","ImageStitcher","inputRef","imageListRef","setImgDataUrlList","setCropRangeList","resultImageRef","resultURL","setResultURL","selectImage","a","fileList","files","list","file","blobUrl","Array","fill","stitchImages","stitchedImgDataUrl","saveImage","MouseEvent","download","href","dispatchEvent","accept","multiple","onClick","click","item","index","onSelectorChange","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"8QAWaA,EAAU,WACnB,IAAMC,EAAI,IAAIC,KACRC,EAAOF,EAAEG,cAAcC,WACvBC,GAASL,EAAEM,WAAa,KAAKF,WAAWG,UAAU,GAClDC,GAAQR,EAAED,UAAY,KAAKK,WAAWG,UAAU,GACtD,MAAM,GAAN,OAAUL,GAAV,OAAiBG,GAAjB,OAAyBG,I,eCZ7B,SAASC,EAAgBC,GACrB,OAAO,IAAIC,SAAgB,SAACC,EAASC,GACjC,IAAMC,EAAS,IAAIC,WACnBD,EAAOE,UAAY,SAAAC,GACf,IAAMC,EAAaD,EAAME,OAAQC,OACjCR,EAAQM,IAEZJ,EAAOO,QAAU,SAAAC,GAAG,OAAIT,EAAOS,IAC/BR,EAAOS,cAAcb,MAI7B,SAASc,EAAiBC,GACtB,IAAMC,EAAcD,EAAeE,KAAI,SAAAT,GACnC,OAAO,IAAIP,SAA0B,SAACC,EAASC,GAC3C,IAAMe,EAAM,IAAIC,MAChBD,EAAIE,IAAMZ,EACVU,EAAIG,OAAS,WACTnB,EAAQgB,UAIpB,OAAOjB,QAAQqB,IAAIN,GAGvB,SAASO,EAAqBC,EAA8BC,EAAeC,GACvE,IACMC,EAASF,EADaD,EAAvBC,MAECG,EAASF,EAFaF,EAAbE,OAGTG,EAASC,SAASC,cAAc,UACtCF,EAAOG,aAAa,QAASP,EAAM/B,YACnCmC,EAAOG,aAAa,SAAUN,EAAOhC,YACrC,IAAMuC,EAAMJ,EAAOK,WAAW,MAG9B,OAFG,OAAHD,QAAG,IAAHA,KAAKE,MAAMR,EAAQC,GAChB,OAAHK,QAAG,IAAHA,KAAKG,UAAUZ,EAAY,EAAG,GAC9B,OAAOS,QAAP,IAAOA,OAAP,EAAOA,EAAKI,aAAa,EAAG,EAAGR,EAAOJ,MAAOI,EAAOH,QAGxD,SAASY,EAAcC,EAAsBC,EAAaC,GACtD,IAAQC,EAAwBH,EAAxBG,KAAMjB,EAAkBc,EAAlBd,MAAOC,EAAWa,EAAXb,OACfiB,EAAQ,EAAIlB,EAAQmB,KAAKC,MAAMnB,EAASc,GACxCM,EAAM,EAAIrB,EAAQmB,KAAKC,MAAMnB,GAAU,EAAIe,IACjD,OAAO,IAAIM,UAAUL,EAAKM,SAASL,EAAOG,GAAMrB,GAGpD,SAASwB,EAAsBC,EAAoCC,GAA6D,IAA1BC,EAAyB,uDAAN,KACrH,GAA8B,IAA1BF,EAAeG,OAAc,MAAO,GAMxC,IAJA,IAAM5B,EAAQ2B,EACRE,EAAa,GACf5B,EAAS,EACP6B,EAA2B,GACxBC,EAAI,EAAGA,EAAIN,EAAeG,SAAUG,EAAG,CAC5C,MAA4BN,EAAeM,GAA/BC,EAAZ,EAAKhC,MAAkBiC,EAAvB,EAAehC,OACTiC,EAAQlC,EAAQgC,EACtBC,GAAKC,EAEL,IAAMC,EAAUrC,EAAqB2B,EAAeM,GAAI/B,EAAOiC,GACzDG,EAAgBvB,EAAa,WAAb,GAAcsB,GAAd,mBAA0BT,EAAcK,MAE9D9B,GAAUmC,EAAcnC,OACxB6B,EAAYO,KAAKD,GACjBP,EAAWQ,KAAKD,EAAcnC,QAGlC,IAAMG,EAASC,SAASC,cAAc,UACtCF,EAAOG,aAAa,QAASP,EAAM/B,YACnCmC,EAAOG,aAAa,SAAUN,EAAOhC,YAGrC,IAFA,IAAMuC,EAAMJ,EAAOK,WAAW,MAC1B6B,EAAQ,EACJP,EAAI,EAAGA,EAAID,EAAYF,SAAUG,EAClC,OAAHvB,QAAG,IAAHA,KAAK+B,aAAaT,EAAYC,GAAI,EAAGO,GACrCA,GAAST,EAAWE,GAGxB,OAAO3B,EAAOoC,YAGlB,IA4EMC,EAAuC,SAAC,GAGvC,IAAD,EAFF9C,EAEE,EAFFA,IACA+C,EACE,EADFA,SAGA,EAAoCC,oBAAkB,GAAtD,mBAAOC,EAAP,KAAmBC,EAAnB,KACA,EAAkCF,mBAAiB,GAAnD,mBAAOG,EAAP,KAAkBC,EAAlB,KACA,EAA4CJ,mBAAiB,GAA7D,mBAAOK,EAAP,KAAuBC,EAAvB,KAEA,EAA0CN,oBAAkB,GAA5D,mBAAOO,EAAP,KAAsBC,EAAtB,KACA,EAAwCR,mBAAiB,GAAzD,mBAAOS,EAAP,KAAqBC,EAArB,KACA,EAAkDV,mBAAiB,GAAnE,mBAAOW,EAAP,KAA0BC,EAA1B,KAEMC,EAASC,iBAAuB,MAChCC,EAAYD,iBAAuB,MACnCE,EAAUF,iBAAuB,MACjCxD,EAAM,UAAG0D,EAAQC,eAAX,aAAG,EAAiBC,aAE1BC,EAAgB,SAACC,GACnBlB,GAAc,GACdE,EAAwB,cAAXgB,EAAEC,KAAuBD,EAAEE,MAAQF,EAAEG,cAAc,GAAGD,QAGjEE,EAAmB,SAACJ,GACtBZ,GAAiB,GACjBE,EAA2B,cAAXU,EAAEC,KAAuBD,EAAEE,MAAQF,EAAEG,cAAc,GAAGD,QAGpEG,ED1Lc,SAACC,GACrB,IAAIC,GAAO,EACLC,EAAS,kBAAMD,GAAO,GAC5B,OAAO,WACCA,IACJA,GAAO,EACPD,EAAE,WAAF,aACAG,sBAAsBD,KCmLXE,EAAS,SAACV,GACrB,IAAME,EAAmB,cAAXF,EAAEC,KAAuBD,EAAEE,MAAQF,EAAEG,cAAc,GAAGD,MACpE,GAAIrB,EAAY,CACZ,IACI8B,EAAS1B,GADIiB,EAAQnB,GAErB4B,EAAS,EAAGA,EAAS,EAChBA,EAASzE,EAAUqD,IAAmBoB,EAASzE,EAAUqD,GAClEE,EAAOI,QAASe,MAAM5D,IAAtB,UAA+B2D,EAA/B,MACA,IAAME,EAAaF,EAASzE,EACtB4E,EAAgB,EAAIvB,EAAoBrD,EAC9C0D,EAAQC,QAASe,MAAMG,WAAvB,wFAEiC,IAAXF,EAFtB,6CAG+B,IAAXA,EAHpB,6CAIkC,IAAdC,EAJpB,+CAKoC,IAAdA,EALtB,WAMG,GAAI3B,EAAe,CACtB,IACI6B,EAAYzB,GADCF,EAAea,GAE5Bc,EAAY,EAAGA,EAAY,EACtBA,EAAY9E,EAAU+C,IAAgB+B,EAAY9E,EAAU+C,GACrEU,EAAUE,QAASe,MAAM3D,OAAzB,UAAqC+D,EAArC,MACA,IAAMH,EAAa5B,EAAiB/C,EAC9B4E,EAAgB,EAAIE,EAAY9E,EACtC0D,EAAQC,QAASe,MAAMG,WAAvB,wFAEiC,IAAXF,EAFtB,6CAG+B,IAAXA,EAHpB,6CAIkC,IAAdC,EAJpB,+CAKoC,IAAdA,EALtB,UAgCR,OAvBAG,qBAAU,WACN,IAAMC,EAAkB,WACpB,IAAIlE,EAAMyC,EAAOI,QAASe,MAAM5D,IAChCA,EAAMA,EAAI3C,UAAU,EAAG2C,EAAIa,OAAS,GACpCqB,EAAkBiC,OAAOnE,IAEzB,IAAIC,EAAS0C,EAAUE,QAASe,MAAM3D,OACtCA,EAASA,EAAO5C,UAAU,EAAG4C,EAAOY,OAAS,GAC7C2B,EAAqB2B,OAAOlE,KAExB4B,GAAcM,IAAeR,EAASwC,OAAOnE,GAAOd,EAASiF,OAAOlE,GAAUf,GAClF4C,GAAc,GACdM,GAAiB,IAEfgC,EAAO9E,SAAS+E,cAAc,QAGpC,OAFAD,EAAME,iBAAiB,UAAWJ,GAClCE,EAAME,iBAAiB,WAAYJ,GAC5B,WACHE,EAAMG,oBAAoB,UAAWL,GACrCE,EAAMG,oBAAoB,WAAYL,MAE3C,CAAChF,EAAQyC,EAAUE,EAAYM,IAG9B,sBAAKqC,UAAU,gBAAgBC,YAAapB,EAAQqB,YAAarB,EAAjE,UACI,qBAAKmB,UAAU,eAAe5F,IAAKA,EAAK+F,IAAI,iBAC5C,sBAAKH,UAAU,WAAWI,IAAKhC,EAA/B,UACI,qBAAK4B,UAAU,cAAcI,IAAKnC,EAAQoC,YAAa9B,EAAe+B,aAAc/B,IACpF,qBAAKyB,UAAU,iBAAiBI,IAAKjC,EAAWkC,YAAazB,EAAkB0B,aAAc1B,WAM9F2B,EA3KW,WACtB,IAAMC,EAAWtC,iBAAyB,MACpCuC,EAAevC,iBAAuB,MAC5C,EAA4Cd,mBAAmB,IAA/D,mBAAOrD,EAAP,KAAuB2G,EAAvB,KACA,EAA0CtD,mBAA6B,IAAvE,mBAAOjB,EAAP,KAAsBwE,EAAtB,KACMC,EAAiB1C,iBAAyB,MAChD,EAAkCd,mBAAiB,IAAnD,mBAAOyD,EAAP,KAAkBC,EAAlB,KAEMC,EAAW,uCAAG,WAAOvC,GAAP,uBAAAwC,EAAA,sDACVC,EAAWzC,EAAE/E,OAAOyH,MACpBC,EAAiB,GACd3E,EAAI,EAHG,YAGAA,EAAIyE,EAAS5E,QAHb,wBAIN+E,EAAOH,EAASzE,GAJV,SAKUzD,EAAgBqI,GAL1B,OAKNC,EALM,OAMZF,EAAKrE,KAAKuE,GANE,SAGuB7E,EAHvB,uBAQhBsE,EAAa,IACbJ,EAAkBS,GAClBR,EAAiB,IAAIW,MAAMH,EAAK9E,QAAQkF,KAAK,CAAC,EAAG,KAVjC,4CAAH,sDAaXC,EAAY,uCAAG,8BAAAR,EAAA,sEACgClH,EAAiBC,GADjD,OACXmC,EADW,OAEXuF,EAAqBxF,EAAsBC,EAAgBC,EAAe,MAChF2E,EAAaW,GAHI,2CAAH,qDAMZC,EAAS,uCAAG,iBAAAV,EAAA,WAAAA,EAAA,sDACRA,EAAIlG,SAASC,cAAc,KAC3BxB,EAAQ,IAAIoI,WAAW,SAC7BX,EAAEY,SAAF,uBAAmBvJ,KACnB2I,EAAEa,KAAOhB,EACTG,EAAEc,cAAcvI,GALF,2CAAH,qDAiBf,OACI,sBAAKyG,UAAU,iBAAf,UACI,uBAAOI,IAAKI,EAAU/B,KAAK,OAAOsD,OAAO,UAAUC,UAAQ,EAAC7E,SAAU4D,IACtE,sBAAKf,UAAU,eAAf,UACI,wBAAQA,UAAU,kBAAkBiC,QAAS,kCAAMzB,EAASnC,eAAf,aAAM,EAAkB6D,SAArE,sCACCnI,EAAesC,OAAS,GACrB,sBAAK2D,UAAU,mBAAf,UACI,wBAAQA,UAAU,YAAYiC,QAXlC,WACZnB,EAAa,KAUG,0BACA,wBAAQd,UAAU,aAAaiC,QAAST,EAAxC,0BACA,wBAAQxB,UAAU,WAAWiC,QAASP,EAAtC,gCAIG,KAAdb,GACG,qBAAKb,UAAU,aAAaI,IAAKK,EAAjC,SACK1G,EAAeE,KAAI,SAACkI,EAAM3F,GAAP,OAAa,cAAC,EAAD,CAAoCpC,IAAK+H,EAAMhF,SAAU,SAAC3B,EAAKC,GAAN,OAxBjF,SAAC2G,EAAe5G,EAAaC,GAClDU,EAAciG,GAAS,CAAC5G,EAAKC,GAC7BkF,EAAiB,YAAIxE,IAsBkGkG,CAAiB7F,EAAGhB,EAAKC,KAAnG,mBAA+Be,SAGzD,KAAdqE,GACG,qBAAKb,UAAU,SAAf,SACI,qBAAKA,UAAU,eAAeI,IAAKQ,EAAgBxG,IAAKyG,EAAWV,IAAI,+CCxI5EmC,EANC,kBACZ,qBAAKtC,UAAU,MAAf,SACI,cAAC,EAAD,OCQOuC,EAZS,SAACC,GACjBA,GAAeA,aAAuBC,UACtC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QACzDJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCHpBQ,IAASC,OACL,cAAC,IAAMC,WAAP,UACI,cAAC,EAAD,MAEJpI,SAASqI,eAAe,SAM5BZ,M","file":"static/js/main.64bbecdc.chunk.js","sourcesContent":["export const throttle = (fn: CallableFunction) => {\r\n    let lock = false;\r\n    const unLock = () => lock = false;\r\n    return (...args: any[]) => {\r\n        if (lock) return;\r\n        lock = true;\r\n        fn(...args);\r\n        requestAnimationFrame(unLock);\r\n    };\r\n};\r\n\r\nexport const getDate = () => {\r\n    const d = new Date();\r\n    const year = d.getFullYear().toString();\r\n    const month = (d.getMonth() + 101).toString().substring(1);\r\n    const date = (d.getDate() + 100).toString().substring(1);\r\n    return `${year}${month}${date}`;\r\n}","import { FC, ReactElement, useEffect, useRef, useState } from 'react';\r\nimport { getDate, throttle } from '../../utils/common';\r\nimport './index.css';\r\n\r\nfunction getImageDataUrl(blob: Blob) {\r\n    return new Promise<string>((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onloadend = event => {\r\n            const imgDataUrl = event.target!.result as string;\r\n            resolve(imgDataUrl);\r\n        };\r\n        reader.onerror = err => reject(err);\r\n        reader.readAsDataURL(blob);\r\n    });\r\n}\r\n\r\nfunction getImageElements(imgDataUrlList: string[]) {\r\n    const promiseList = imgDataUrlList.map(imgDataUrl => {\r\n        return new Promise<HTMLImageElement>((resolve, reject) => {\r\n            const img = new Image();\r\n            img.src = imgDataUrl;\r\n            img.onload = () => {\r\n                resolve(img);\r\n            };\r\n        });\r\n    });\r\n    return Promise.all(promiseList);\r\n}\r\n\r\nfunction imgElement2ImageData(imgElement: HTMLImageElement, width: number, height: number) {\r\n    let {width: w, height: h} = imgElement;\r\n    const ratioW = width / w;\r\n    const ratioH = height / h;\r\n    const canvas = document.createElement('canvas');\r\n    canvas.setAttribute('width', width.toString());\r\n    canvas.setAttribute('height', height.toString());\r\n    const ctx = canvas.getContext('2d');\r\n    ctx?.scale(ratioW, ratioH);\r\n    ctx?.drawImage(imgElement, 0, 0);\r\n    return ctx?.getImageData(0, 0, canvas.width, canvas.height)!;\r\n}\r\n\r\nfunction cropImageData(imageData: ImageData, top: number, bottom: number) {\r\n    const { data, width, height } = imageData;\r\n    const start = 4 * width * Math.floor(height * top);\r\n    const end = 4 * width * Math.floor(height * (1 - bottom));\r\n    return new ImageData(data.subarray(start, end), width);\r\n}\r\n\r\nfunction cropAndConcatImgDatas(imgElementList: HTMLImageElement[], cropRangeList: [number, number][], maxWidth: number = 1080) {\r\n    if (imgElementList.length === 0) return '';\r\n\r\n    const width = maxWidth;\r\n    const heightList = [];\r\n    let height = 0;\r\n    const imgDataList: ImageData[] = [];\r\n    for (let i = 0; i < imgElementList.length; ++i) {\r\n        let {width: w, height: h} = imgElementList[i];\r\n        const ratio = width / w;\r\n        h *= ratio;\r\n\r\n        const imgData = imgElement2ImageData(imgElementList[i], width, h);\r\n        const cropedImgData = cropImageData(imgData, ...cropRangeList[i]);\r\n\r\n        height += cropedImgData.height;\r\n        imgDataList.push(cropedImgData);\r\n        heightList.push(cropedImgData.height);\r\n    }\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.setAttribute('width', width.toString());\r\n    canvas.setAttribute('height', height.toString());\r\n    const ctx = canvas.getContext('2d');\r\n    let lastY = 0;\r\n    for(let i = 0; i < imgDataList.length; ++i) {\r\n        ctx?.putImageData(imgDataList[i], 0, lastY);\r\n        lastY += heightList[i];\r\n    }\r\n\r\n    return canvas.toDataURL();\r\n}\r\n\r\nconst ImageStitcher: FC = (): ReactElement => {\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const imageListRef = useRef<HTMLDivElement>(null);\r\n    const [imgDataUrlList, setImgDataUrlList] = useState<string[]>([]);\r\n    const [cropRangeList, setCropRangeList] = useState<[number, number][]>([]);\r\n    const resultImageRef = useRef<HTMLImageElement>(null);\r\n    const [resultURL, setResultURL] = useState<string>('');\r\n\r\n    const selectImage = async (e: any) => {\r\n        const fileList = e.target.files;\r\n        const list: string[] = [];\r\n        for (let i = 0; i < fileList.length; ++i) {\r\n            const file = fileList[i];\r\n            const blobUrl = await getImageDataUrl(file);\r\n            list.push(blobUrl);\r\n        }\r\n        setResultURL('');\r\n        setImgDataUrlList(list);\r\n        setCropRangeList(new Array(list.length).fill([0, 0]));\r\n    };\r\n\r\n    const stitchImages = async () => {\r\n        const imgElementList: HTMLImageElement[] = await getImageElements(imgDataUrlList);\r\n        const stitchedImgDataUrl = cropAndConcatImgDatas(imgElementList, cropRangeList, 1080);\r\n        setResultURL(stitchedImgDataUrl);\r\n    };\r\n\r\n    const saveImage = async () => {\r\n        const a = document.createElement('a');\r\n        const event = new MouseEvent('click');\r\n        a.download = `长图_${getDate()}`;\r\n        a.href = resultURL;\r\n        a.dispatchEvent(event);\r\n    }\r\n\r\n    const onSelectorChange = (index: number, top: number, bottom: number) => {\r\n        cropRangeList[index] = [top, bottom];\r\n        setCropRangeList([...cropRangeList]);\r\n    };\r\n\r\n    const onReset = () => {\r\n        setResultURL('');\r\n    };\r\n\r\n    return (\r\n        <div className=\"image-stitcher\">\r\n            <input ref={inputRef} type=\"file\" accept=\"image/*\" multiple onChange={selectImage} />\r\n            <div className=\"button-group\">\r\n                <button className=\"select-file-btn\" onClick={() => inputRef.current?.click()}>选择图片</button>\r\n                {imgDataUrlList.length > 0 && (\r\n                    <div className=\"stitch-btn-group\">\r\n                        <button className=\"reset-btn\" onClick={onReset}>重置</button>\r\n                        <button className=\"stitch-btn\" onClick={stitchImages}>拼接</button>\r\n                        <button className=\"save-btn\" onClick={saveImage}>保存</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n            {resultURL === '' && (\r\n                <div className=\"image-list\" ref={imageListRef}>\r\n                    {imgDataUrlList.map((item, i) => <AreaSelector key={`selector-${i}`} src={item} onChange={(top, bottom) => onSelectorChange(i, top, bottom)} />)}\r\n                </div>\r\n            )}\r\n            {resultURL !== '' && (\r\n                <div className=\"result\">\r\n                    <img className=\"result-image\" ref={resultImageRef} src={resultURL} alt=\"拼接后的图片\" />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface IAreaSelectorProps {\r\n    src: string;\r\n    onChange: (top: number, bottom: number) => void;\r\n}\r\n\r\nconst AreaSelector: FC<IAreaSelectorProps> = ({\r\n    src,\r\n    onChange\r\n}) => {\r\n\r\n    const [topTouched, setTopTouched] = useState<boolean>(false);\r\n    const [topStartY, setTopStartY] = useState<number>(0);\r\n    const [topStartOffset, setTopStartOffset] = useState<number>(0);\r\n\r\n    const [bottomTouched, setBottomTouched] = useState<boolean>(false);\r\n    const [bottomStartY, setBottomStartY] = useState<number>(0)\r\n    const [bottomStartOffset, setBottomStartOffset] = useState<number>(0);\r\n\r\n    const topRef = useRef<HTMLDivElement>(null);\r\n    const bottomRef = useRef<HTMLDivElement>(null);\r\n    const areaRef = useRef<HTMLDivElement>(null);\r\n    const height = areaRef.current?.clientHeight;\r\n\r\n    const onTopBarStart = (e: any) => {\r\n        setTopTouched(true);\r\n        setTopStartY(e.type === 'mousedown' ? e.pageY : e.targetTouches[0].pageY);\r\n    };\r\n\r\n    const onBottomBarStart = (e: any) => {\r\n        setBottomTouched(true);\r\n        setBottomStartY(e.type === 'mousedown' ? e.pageY : e.targetTouches[0].pageY);\r\n    };\r\n\r\n    const onMove = throttle((e: any) => {\r\n        const pageY = e.type === 'mousemove' ? e.pageY : e.targetTouches[0].pageY;\r\n        if (topTouched) {\r\n            const distance = pageY - topStartY;\r\n            let newTop = topStartOffset + distance;\r\n            if (newTop < 0) newTop = 0;\r\n            else if (newTop > height! - bottomStartOffset) newTop = height! - bottomStartOffset;\r\n            topRef.current!.style.top = `${newTop}px`;\r\n            const topPercent = newTop / height!;\r\n            const bottomPercent = 1 - bottomStartOffset / height!;\r\n            areaRef.current!.style.background = `\r\n                linear-gradient(to bottom,\r\n                rgba(0,0,0,0.7) ${topPercent*100}%,\r\n                rgba(0,0,0,0) ${topPercent*100}%,\r\n                rgba(0,0,0,0) ${bottomPercent*100}%,\r\n                rgba(0,0,0,0.7) ${bottomPercent*100}%)`;\r\n        } else if (bottomTouched) {\r\n            const distance = bottomStartY - pageY;\r\n            let newBottom = bottomStartOffset + distance;\r\n            if (newBottom < 0) newBottom = 0;\r\n            else if (newBottom > height! - topStartOffset) newBottom = height! - topStartOffset;\r\n            bottomRef.current!.style.bottom = `${newBottom}px`;\r\n            const topPercent = topStartOffset / height!;\r\n            const bottomPercent = 1 - newBottom / height!;\r\n            areaRef.current!.style.background = `\r\n                linear-gradient(to bottom,\r\n                rgba(0,0,0,0.7) ${topPercent*100}%,\r\n                rgba(0,0,0,0) ${topPercent*100}%,\r\n                rgba(0,0,0,0) ${bottomPercent*100}%,\r\n                rgba(0,0,0,0.7) ${bottomPercent*100}%)`;\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        const mouseUpListener = () => {\r\n            let top = topRef.current!.style.top;\r\n            top = top.substring(0, top.length - 2);\r\n            setTopStartOffset(Number(top));\r\n\r\n            let bottom = bottomRef.current!.style.bottom;\r\n            bottom = bottom.substring(0, bottom.length - 2);\r\n            setBottomStartOffset(Number(bottom));\r\n            \r\n            if (topTouched || bottomTouched) onChange(Number(top) / height!, Number(bottom) / height!);\r\n            setTopTouched(false);\r\n            setBottomTouched(false);\r\n        };\r\n        const body = document.querySelector('body');\r\n        body!.addEventListener('mouseup', mouseUpListener);\r\n        body!.addEventListener('touchend', mouseUpListener);\r\n        return () => {\r\n            body!.removeEventListener('mouseup', mouseUpListener);\r\n            body!.removeEventListener('touchend', mouseUpListener);\r\n        };\r\n    }, [height, onChange, topTouched, bottomTouched]);\r\n\r\n    return (\r\n        <div className=\"area-selector\" onMouseMove={onMove} onTouchMove={onMove}>\r\n            <img className=\"source-image\" src={src} alt=\"图片\" />\r\n            <div className=\"area-box\" ref={areaRef}>\r\n                <div className=\"bar top-bar\" ref={topRef} onMouseDown={onTopBarStart} onTouchStart={onTopBarStart}></div>\r\n                <div className=\"bar bottom-bar\" ref={bottomRef} onMouseDown={onBottomBarStart} onTouchStart={onBottomBarStart}></div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ImageStitcher;\r\n","import { FC, ReactElement } from 'react';\nimport './App.css';\nimport ImageStitcher from './components/ImageStitcher';\n\nconst App: FC = (): ReactElement => (\n    <div className=\"app\">\n        <ImageStitcher />\n    </div>\n);\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n    if (onPerfEntry && onPerfEntry instanceof Function) {\n        import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n            getCLS(onPerfEntry);\n            getFID(onPerfEntry);\n            getFCP(onPerfEntry);\n            getLCP(onPerfEntry);\n            getTTFB(onPerfEntry);\n        });\n    }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}