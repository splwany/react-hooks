(this["webpackJsonpreact-hooks"]=this["webpackJsonpreact-hooks"]||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){},17:function(t,e,n){},19:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n.n(r),c=n(9),o=n.n(c),u=(n(14),n(15),n(3)),s=n.n(u),i=n(6),l=n(2),b=n(8),g=function(){var t=new Date,e=t.getFullYear().toString(),n=(t.getMonth()+101).toString().substring(1),r=(t.getDate()+100).toString().substring(1);return"".concat(e).concat(n).concat(r)},h=(n(17),n(0));function d(t){return new Promise((function(e,n){var r=new FileReader;r.onloadend=function(t){var n=t.target.result;e(n)},r.onerror=function(t){return n(t)},r.readAsDataURL(t)}))}function f(t){var e=t.map((function(t){return new Promise((function(e,n){var r=new Image;r.src=t,r.onload=function(){e(r)}}))}));return Promise.all(e)}function v(t,e,n){var r=e/t.width,a=n/t.height,c=document.createElement("canvas");c.setAttribute("width",e.toString()),c.setAttribute("height",n.toString());var o=c.getContext("2d");return null===o||void 0===o||o.scale(r,a),null===o||void 0===o||o.drawImage(t,0,0),null===o||void 0===o?void 0:o.getImageData(0,0,c.width,c.height)}function j(t,e,n){var r=t.data,a=t.width,c=t.height,o=4*a*Math.floor(c*e),u=4*a*Math.floor(c*(1-n));return new ImageData(r.subarray(o,u),a)}function m(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1080;if(0===t.length)return"";for(var r=n,a=[],c=0,o=[],u=0;u<t.length;++u){var s=t[u],i=s.width,l=s.height,g=r/i;l*=g;var h=v(t[u],r,l),d=j.apply(void 0,[h].concat(Object(b.a)(e[u])));c+=d.height,o.push(d),a.push(d.height)}var f=document.createElement("canvas");f.setAttribute("width",r.toString()),f.setAttribute("height",c.toString());for(var m=f.getContext("2d"),p=0,O=0;O<o.length;++O)null===m||void 0===m||m.putImageData(o[O],0,p),p+=a[O];return f.toDataURL()}var p=function(t){var e,n=t.src,a=t.onChange,c=Object(r.useState)(!1),o=Object(l.a)(c,2),u=o[0],s=o[1],i=Object(r.useState)(0),b=Object(l.a)(i,2),g=b[0],d=b[1],f=Object(r.useState)(0),v=Object(l.a)(f,2),j=v[0],m=v[1],p=Object(r.useState)(!1),O=Object(l.a)(p,2),x=O[0],w=O[1],S=Object(r.useState)(0),y=Object(l.a)(S,2),N=y[0],k=y[1],C=Object(r.useState)(0),E=Object(l.a)(C,2),D=E[0],M=E[1],R=Object(r.useRef)(null),L=Object(r.useRef)(null),T=Object(r.useRef)(null),A=null===(e=T.current)||void 0===e?void 0:e.clientHeight,F=function(t){s(!0),d("mousedown"===t.type?t.pageY:t.targetTouches[0].pageY)},I=function(t){w(!0),k("mousedown"===t.type?t.pageY:t.targetTouches[0].pageY)},Y=function(t){var e=!1,n=function(){return e=!1};return function(){e||(e=!0,t.apply(void 0,arguments),requestAnimationFrame(n))}}((function(t){var e="mousemove"===t.type?t.pageY:t.targetTouches[0].pageY;if(u){var n=j+(e-g);n<0?n=0:n>A-D&&(n=A-D),R.current.style.top="".concat(n,"px");var r=n/A,a=1-D/A;T.current.style.background="\n                linear-gradient(to bottom,\n                rgba(0,0,0,0.7) ".concat(100*r,"%,\n                rgba(0,0,0,0) ").concat(100*r,"%,\n                rgba(0,0,0,0) ").concat(100*a,"%,\n                rgba(0,0,0,0.7) ").concat(100*a,"%)")}else if(x){var c=D+(N-e);c<0?c=0:c>A-j&&(c=A-j),L.current.style.bottom="".concat(c,"px");var o=j/A,s=1-c/A;T.current.style.background="\n                linear-gradient(to bottom,\n                rgba(0,0,0,0.7) ".concat(100*o,"%,\n                rgba(0,0,0,0) ").concat(100*o,"%,\n                rgba(0,0,0,0) ").concat(100*s,"%,\n                rgba(0,0,0,0.7) ").concat(100*s,"%)")}}));return Object(r.useEffect)((function(){var t=function(){var t=R.current.style.top;t=t.substring(0,t.length-2),m(Number(t));var e=L.current.style.bottom;e=e.substring(0,e.length-2),M(Number(e)),(u||x)&&a(Number(t)/A,Number(e)/A),s(!1),w(!1)},e=document.querySelector("body");return e.addEventListener("mouseup",t),e.addEventListener("touchend",t),function(){e.removeEventListener("mouseup",t),e.removeEventListener("touchend",t)}}),[A,a,u,x]),Object(h.jsxs)("div",{className:"area-selector",onMouseMove:Y,onTouchMove:Y,children:[Object(h.jsx)("img",{className:"source-image",src:n,alt:"\u56fe\u7247"}),Object(h.jsxs)("div",{className:"area-box",ref:T,children:[Object(h.jsx)("div",{className:"bar top-bar",ref:R,onMouseDown:F,onTouchStart:F}),Object(h.jsx)("div",{className:"bar bottom-bar",ref:L,onMouseDown:I,onTouchStart:I})]})]})},O=function(){var t=Object(r.useRef)(null),e=Object(r.useRef)(null),n=Object(r.useState)([]),a=Object(l.a)(n,2),c=a[0],o=a[1],u=Object(r.useState)([]),v=Object(l.a)(u,2),j=v[0],O=v[1],x=Object(r.useRef)(null),w=Object(r.useState)(""),S=Object(l.a)(w,2),y=S[0],N=S[1],k=function(){var t=Object(i.a)(s.a.mark((function t(e){var n,r,a,c,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.target.files,r=[],a=0;case 3:if(!(a<n.length)){t.next=12;break}return c=n[a],t.next=7,d(c);case 7:u=t.sent,r.push(u);case 9:++a,t.next=3;break;case 12:N(""),o(r),O(new Array(r.length).fill([0,0]));case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),C=function(){var t=Object(i.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f(c);case 2:e=t.sent,n=m(e,j,1080),N(n);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),E=function(){var t=Object(i.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=document.createElement("a"),n=new MouseEvent("click"),e.download="\u957f\u56fe_".concat(g()),e.href=y,e.dispatchEvent(n);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(h.jsxs)("div",{className:"image-stitcher",children:[Object(h.jsx)("input",{ref:t,type:"file",accept:"image/*",multiple:!0,onChange:k}),Object(h.jsxs)("div",{className:"button-group",children:[Object(h.jsx)("button",{className:"select-file-btn",onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.click()},children:"\u9009\u62e9\u56fe\u7247"}),c.length>0&&Object(h.jsxs)("div",{className:"stitch-btn-group",children:[Object(h.jsx)("button",{className:"reset-btn",onClick:function(){N("")},children:"\u91cd\u7f6e"}),Object(h.jsx)("button",{className:"stitch-btn",onClick:C,children:"\u62fc\u63a5"}),Object(h.jsx)("button",{className:"save-btn",onClick:E,children:"\u4fdd\u5b58"})]})]}),""===y&&Object(h.jsx)("div",{className:"image-list",ref:e,children:c.map((function(t,e){return Object(h.jsx)(p,{src:t,onChange:function(t,n){return function(t,e,n){j[t]=[e,n],O(Object(b.a)(j))}(e,t,n)}},"selector-".concat(e))}))}),""!==y&&Object(h.jsx)("div",{className:"result",children:Object(h.jsx)("img",{className:"result-image",ref:x,src:y,alt:"\u62fc\u63a5\u540e\u7684\u56fe\u7247"})})]})},x=function(){return Object(h.jsx)("div",{className:"app",children:Object(h.jsx)(O,{})})},w=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,20)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),r(t),a(t),c(t),o(t)}))};o.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(x,{})}),document.getElementById("root")),w()}},[[19,1,2]]]);
//# sourceMappingURL=main.64bbecdc.chunk.js.map